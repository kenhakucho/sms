<script>
  $('#upfile').change(function(){
    if (this.files.length > 0) {
    var file = this.files[0];    
    var reader = new FileReader();
    reader.readAsDataURL(file);
    
    reader.onload = function() {
      $('#thumbnail').attr('src', reader.result );
    }
  }
});
    
<script src="/socket.io/socket.io.js"></script>
<script type="text/javascript">
// var socket = io.connect('http://localhost:3000');
var socket = io.connect('http://10.211.55.2/');
socket.on('connect', function(msg) {
  console.log("connet");
  document.getElementById("connectId").innerHTML = 
    "あなたの接続ID::" + socket.socket.transport.sessid;
  document.getElementById("type").innerHTML = 
    "接続方式::" + socket.socket.transport.name;
});

// メッセージを受けたとき
socket.on('message', function(msg) {
  // メッセージを画面に表示する
  document.getElementById("receiveMsg").innerHTML = msg.value;
});

// メッセージを送る
function SendMsg() {
  var msg = document.getElementById("message").value;
  // メッセージを発射する
  socket.emit('message', { value: msg });
}
// 切断する
function DisConnect() {
  var msg = socket.socket.transport.sessid + "は切断しました。";
  // メッセージを発射する
  socket.emit('message', { value: msg });
  // socketを切断する
  socket.disconnect();
}

</script>

    <% layout('layout') %>
    <% if (postList.length) { %>
        <div class="white-bg scroll">
            <ul class="main-list">
                <% postList.forEach(function(post) { %>
                    <li class="main-list_item">
                        <div class="post_item">
                          <% if (user.id == post.user_id) { %>
                            <p class="post_icon left"><img width="45" height="45" src="/images/uploads/<%= post.user_icon %>"/></p>
                            <p class="post_user"><%= post.user_nickname %>(<%= post.user_name %>)</p>
                            <% if (post.isstamp==1) { %>
                              <p class="post_image"><img width="60" height="60" src="/images/uploads/<%= post.message_file %>"/></p>
                            <% } %>
                            <p class="post_message"><%= post.post_message %></p>
                            <p class="post_date"><%= post._madetime %></p>
                          <% } else { %>
                            <p class="post_icon right"><img width="45" height="45" src="/images/uploads/<%= post.user_icon %>"/></p>
                            <p class="post_user"><%= post.user_nickname %>(<%= post.user_name %>)</p>
                            <% if (post.isstamp==1) { %>
                              <p class="post_image"><img width="60" height="60" src="/images/uploads/<%= post.message_file %>"/></p>
                            <% } %>
                            <p class="post_message"><%= post.post_message %></p>
                            <p class="post_date"><%= post._madetime %></p>
                          <% } %>

                        </div>
                    </li>
                <% }); %>
            </ul>
        </div>
    <% } %>

    <form action="/room/<%= room.id %>" method="post" enctype="multipart/form-data" class="room-form">
        <input type="text" name="message" class="input">
        <button type="submit" class="submit">投稿</button>        
        <br>
        
        <button class="file-wrap">
            <span class="label">画像<input type="file" id="upfile" name="image_file" class="file"></span>
        </button>
        <br>
        <p><img id="thumbnail" src=""/></p>
    </form>

    <a href="/" class="btn"><button>トップへもどる</button></a>
    <% if (typeof user !== 'undefined') { %>
      <span class="login-user"><%= user.name %>さんとしてログインしています</span>
    <% } %>

